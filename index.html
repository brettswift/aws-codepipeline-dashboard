<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>title</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>

<h1>Pipeline Dashboard</h1>
  <div id="container">
    
  </div>

  
  <script type="text/javascript">
  // Pattern based on https://gist.github.com/morena/87f80bac4f73072d9ec2
  $(document).ready(function(){
    $.when(
        $.ajax({url: "templates.mst", dataType: 'text'}),
        $.ajax({url: "status.json"})
    )
    .done(function(template, data){
      Mustache.parse(template[0]);
      const json = data[0]
      // console.log(JSON.stringify(json, null, 2))
      console.log(template)
      var rendered = Mustache.render(template[0], json);
      $('#container').html(rendered);

    })
    .fail(function(){
      alert("Sorry there was an error.");
    });
  });
  </script>
    
  </body>
<!-- 
<body>

<h1>Pipeline Dashboard</h1>

<script>
var url = "http://localhost:8000/status.json";

$(document).ready(function(){
  $.ajax({
    url: url,
    dataType: 'json',
      error: function(){
        console.log('JSON FAILED for data');
      },
    success:function(data){

      var pipeline_template = 
        "{{#pipelines}}" + 
          '<div class="pipeline"> ' + 
          '<div class="pipelineName">{{name}}</div>' +
          '<ul>{{#stages}}{{>stage}}{{/stages}}</ul>{{/pipelines}}' + 
          '</div>';

      const stage_tpl = "<li>{{name}} <br>  {{status}} {{succeedTime}} <ul>{{#actions}}{{>action}}{{/actions}}</ul></li>"
      const action_tpl = "<li>{{name}} {{status}} </li>"
      var partials = {stage: stage_tpl, action: action_tpl};

      var html = Mustache.to_html(pipeline_template, data, partials);
      $('#content_container').html(html);
      
    }  // end of success fn
   }) // end of Ajax call
 }) // end of $(document).ready() function
</script>


<div id="content_container"></div>
</body> -->

</html>